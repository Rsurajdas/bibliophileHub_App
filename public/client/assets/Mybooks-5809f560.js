import{j as e,P as a,r,u as $,L as B,C as F,S as X}from"./index-a0051c01.js";import{r as O,i as I}from"./Form-2c2a6d0b.js";import{B as c}from"./Button-57ddcc21.js";import{k as C,Q as w}from"./react-toastify.esm-df7bf5c6.js";import{a as z}from"./axios-4a70c6fc.js";import{R as M,S as D,M as Q,a as U,b as J}from"./SelectShelf-c25c0a13.js";/* empty css                      */import{R as E,C as R}from"./Row-f8d353d5.js";import"./useForkRef-3114d95e.js";import"./debounce-517eeb3c.js";import"./useIsFocusVisible-1aa6f67c.js";import"./useTheme-31f72805.js";var T={},K=I;Object.defineProperty(T,"__esModule",{value:!0});var P=T.default=void 0,Y=K(O()),Z=e,V=(0,Y.default)((0,Z.jsx)("path",{d:"M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"}),"Menu");P=T.default=V;var A={},ee=I;Object.defineProperty(A,"__esModule",{value:!0});var H=A.default=void 0,te=ee(O()),se=e,ae=(0,te.default)((0,se.jsx)("path",{d:"M13 13v8h8v-8h-8zM3 21h8v-8H3v8zM3 3v8h8V3H3zm13.66-1.31L11 7.34 16.66 13l5.66-5.66-5.66-5.65z"}),"Widgets");H=A.default=ae;const L=({book:t,shelves:l,shelfId:i,shelfName:p,removeBook:u,handleUpdateShelf:n})=>{const[h,o]=r.useState(!1),[j,g]=r.useState(!1),[b,x]=r.useState(0),f=$("token"),v=r.useRef(null),[_,N]=r.useState(""),k=async(s,d)=>{try{if(s.preventDefault(),b){const m={rating:d,review:v.current.value},y=await z.patch(`https://boiling-wildwood-46640-30ec30629e36.herokuapp.com/api/v1/books/${t.book._id}/reviews`,m,{headers:{Authorization:`Bearer ${f}`}}),{data:S}=y;x(S.data.review.rating),N(S.data.review.review),w.success(`Rating updated to ${d} star rating`),g(!1)}else{const m={rating:d,review:v.current.value},y=await z.post(`https://boiling-wildwood-46640-30ec30629e36.herokuapp.com/api/v1/books/${t.book._id}/reviews`,m,{headers:{Authorization:`Bearer ${f}`}}),{data:S}=y;x(S.data.review.rating),N(S.data.review.review),w.success(`${d} star rating is saved`),g(!1)}}catch(m){w.error(m.message)}};return r.useEffect(()=>{var s;(s=t.review)!=null&&s.rating?x(t.review.rating):x(0)},[]),e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{style:{width:"70px"},children:e.jsx("div",{className:"",children:e.jsx(B,{to:`/book/${t.book._id}`,children:e.jsx("img",{src:t.book.book_image,alt:t.book.title,className:"cover-img"})})})}),e.jsx("td",{style:{width:"180px"},children:e.jsx("div",{children:t.book.title})}),e.jsx("td",{style:{width:"90px"},children:e.jsx("div",{children:t.book.author.name})}),e.jsx("td",{style:{width:"90px"},children:e.jsx("div",{children:t.book.publisher})}),e.jsx("td",{style:{width:"110px"},children:e.jsx(M,{name:"book-rating",value:b,size:"small",onChange:k})}),e.jsx("td",{style:{width:"120px"},children:e.jsxs("div",{children:[p||t.shelves[0].shelf_name," ",e.jsx(c,{text:"[edit]",variant:"text",sx:{fontSize:"10px"},onClick:()=>o(!0)})]})}),e.jsx("td",{children:_?e.jsx("p",{children:_}):e.jsx(c,{text:"Write Review",variant:"text",onClick:()=>g(!0)})}),e.jsxs("td",{children:[i?e.jsx(c,{variant:"text",text:"X",onClick:()=>u(i,t.book._id)}):e.jsx(c,{variant:"text",text:"X",onClick:()=>u(t.shelves[0].shelf_id,t.book._id)}),e.jsx(C,{position:"bottom-left"})]}),i?e.jsx(D,{open:h,shelves:l,setOpen:o,handleShelf:n(i,t.book._id)}):e.jsx(D,{open:h,shelves:l,setOpen:o,handleShelf:n(t.shelves[0].shelf_id,t.book._id)})]},t.book._id),e.jsx(Q,{"aria-labelledby":"modal-title","aria-describedby":"modal-desc",open:j,onClose:()=>g(!1),sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsxs(U,{"aria-labelledby":"size-modal-title","aria-describedby":"size-modal-description",size:"lg",children:[e.jsx(J,{variant:"outlined"}),e.jsxs("div",{className:"modal_top",children:[e.jsx("h3",{style:{fontSize:"18px"},className:"mb-2",children:"Write a review"}),e.jsx("div",{className:"text-center my-3",children:e.jsx(M,{name:"book-rating",value:b,size:"large",onChange:k})})]}),e.jsx("div",{className:"modal_bottom",children:e.jsxs("form",{action:"post",onSubmit:k,children:[e.jsx("div",{className:"form-group",children:e.jsx("textarea",{name:"review",id:"review",cols:"50",rows:"30",className:"form-input",style:{height:"90px"},placeholder:"write a review",ref:v})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx(c,{text:"cancel",variant:"solid",sx:{backgroundColor:"#b8b8b8",marginRight:"10px"},type:"button"}),e.jsx(c,{text:"submit",variant:"solid",type:"submit"})]})]})})]})})]})};L.propTypes={book:a.object,handleRating:a.func,shelves:a.array,shelfId:a.string,shelfName:a.string,removeBook:a.func,handleUpdateShelf:a.func,saveRating:a.number};const G=({books:t,removeBook:l,shelves:i,shelfId:p,shelfName:u})=>{const n=$("token"),h=(o,j)=>async(g,b)=>{try{const x={fromShelfId:o,toShelfId:b},f=await z.patch(`https://boiling-wildwood-46640-30ec30629e36.herokuapp.com/api/v1/shelf/move-book/${j}`,x,{headers:{Authorization:`Bearer ${n}`}}),{data:v}=f;w.success(v.message),window.location.reload()}catch(x){w.error(x.message)}};return e.jsxs(e.Fragment,{children:[e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"cover"}),e.jsx("th",{children:"title"}),e.jsx("th",{children:"author"}),e.jsx("th",{children:"Publisher"}),e.jsx("th",{children:"rating"}),e.jsx("th",{children:"Shelf"}),e.jsx("th",{children:"review"}),e.jsx("th",{})]})}),e.jsxs("tbody",{children:[t&&t.map(o=>e.jsx(L,{book:o,shelves:i,shelfId:p,shelfName:u,removeBook:l,handleUpdateShelf:h},o.book._id)),t.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"8",style:{textAlign:"center"},children:"No book was found on the shelf."})})]})]}),e.jsx(C,{position:"bottom-left"})]})};G.propTypes={books:a.array,removeBook:a.func,shelves:a.array,shelfId:a.string,shelfName:a.string};const W=({sx:t,children:l})=>e.jsx("div",{className:"grid",style:t,children:l});W.propTypes={children:a.oneOfType([a.arrayOf(a.node),a.node]),sx:a.object};const ie={gap:"5%"},q=({setShelves:t})=>{const l=$("token"),i=r.useRef(null),p=async u=>{u.preventDefault();try{if(!i.current.value)throw new Error("Shelf name cant be empty");const n={shelf_name:i.current.value},h=await z.post("https://boiling-wildwood-46640-30ec30629e36.herokuapp.com/api/v1/shelf",n,{headers:{Authorization:`Bearer ${l}`}}),{data:o}=h;t(j=>[...j,o.data.shelf]),i.current.value=""}catch(n){w.error(n.message)}};return e.jsxs("form",{method:"POST",onSubmit:p,children:[e.jsxs("div",{className:"d-flex align-items-end",style:ie,children:[e.jsx("input",{type:"text",name:"shelf",id:"shelf",className:"form-input",placeholder:"Add shelf",ref:i}),e.jsx(c,{text:"Add",variant:"solid",type:"submit"})]}),e.jsx(C,{position:"bottom-left"})]})};q.propTypes={setShelves:a.func};const ve=()=>{const[t,l]=r.useState(!0),[i,p]=r.useState([]),[u,n]=r.useState(!0),[h,o]=r.useState([]),[j,g]=r.useState(""),[b,x]=r.useState(""),f=$("token"),v=async()=>{const d=await(await fetch("https://boiling-wildwood-46640-30ec30629e36.herokuapp.com/api/v1/shelf/all-books-user-shelves",{method:"GET",headers:{Authorization:`Bearer ${f}`}})).json();n(!1),p(d.data.books)},_=async()=>{const d=await(await fetch("https://boiling-wildwood-46640-30ec30629e36.herokuapp.com/api/v1/shelf",{method:"GET",headers:{Authorization:`Bearer ${f}`}})).json();n(!1),o(d.data.shelves)},N=async s=>{const m=await(await fetch(`https://boiling-wildwood-46640-30ec30629e36.herokuapp.com/api/v1/shelf/${s}`,{method:"GET",headers:{Authorization:`Bearer ${f}`}})).json();n(!1),g(m.data.shelf._id),x(m.data.shelf.shelf_name),p(m.data.shelf.books)},k=async(s,d)=>{if(window.confirm("Are you sure want to remove this book from shelf?"))try{await(await fetch(`https://boiling-wildwood-46640-30ec30629e36.herokuapp.com/api/v1/shelf/remove-book/${s}/${d}`,{method:"POST",headers:{Authorization:`Bearer ${f}`}})).json(),window.location.reload(!0)}catch(y){w.error(y.message)}};return r.useEffect(()=>{v()},[]),r.useEffect(()=>{_()},[]),e.jsx("main",{children:e.jsxs("section",{style:{paddingBottom:"50px"},children:[e.jsxs(F,{children:[e.jsxs(E,{className:"align-items-center border-bottom pt-3 pb-2",children:[e.jsx(R,{md:6,children:e.jsx("div",{className:"section-header",children:e.jsx("h1",{style:{fontSize:"25px",lineHeight:"26px",fontWeight:600,color:"#282"},children:"My Books"})})}),e.jsx(R,{md:6,children:e.jsxs("div",{className:"d-flex gx-2 justify-content-end",children:[e.jsx(X,{sx:{width:"250px",fontSize:"13px"}}),e.jsx(c,{sx:{padding:"5px"},element:e.jsx(P,{}),onClick:()=>{l(!0)}}),e.jsx(c,{sx:{padding:"5px"},element:e.jsx(H,{}),onClick:()=>{l(!1)}})]})})]}),e.jsxs(E,{className:"mt-2",children:[e.jsx(R,{md:3,children:e.jsxs("div",{className:"book-shelf border-bottom",children:[e.jsxs("h4",{children:["BookShelves ",e.jsx(B,{to:"/",children:"Edit"})]}),e.jsx("div",{className:"pb-2",children:e.jsx(q,{setShelves:o})}),e.jsxs("ul",{className:"mb-2",children:[e.jsx("li",{children:e.jsx(c,{className:"button",variant:"text",text:"All",onClick:v})}),!u&&h&&h.map(s=>e.jsx("li",{children:e.jsx(c,{className:"button",variant:"text",text:s.shelf_name,onClick:()=>N(s._id)})},s._id))]})]})}),e.jsx(R,{md:9,children:t?e.jsx("div",{className:"book-table",children:e.jsx(G,{books:i,removeBook:k,shelves:h,shelfId:j,shelfName:b})}):e.jsx("div",{className:"book-grid",children:e.jsxs(W,{sx:{gridTemplateColumns:"repeat(7, 120px)",gridGap:"2.1%"},children:[i&&i.map(s=>e.jsx("div",{className:"item",children:e.jsx("div",{className:"item-img",children:e.jsx(B,{to:`/book/${s.book._id}`,children:e.jsx("img",{src:s.book.book_image,alt:s.book.title})})})},s.book._id)),i.length===0&&e.jsx("div",{className:"item",style:{gridColumn:"1 / 8",textAlign:"center"},children:"No book was found on the shelf."})]})})})]})]}),e.jsx(C,{position:"bottom-left"})]})})};export{ve as default};
