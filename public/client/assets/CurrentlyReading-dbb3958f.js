import{V as Ve,O as Ye,r as a,W as Qe,l as H,j as t,_ as P,n as J,X as Ze,Y as Je,A as et,p as ze,s as De,t as W,v as D,w as Oe,o as Ie,Z as tt,$ as rt,P as Z,u as Me,g as ot,a0 as nt,a1 as st,a2 as at,a3 as it,L as X,U as oe}from"./index-a7bd720d.js";import{T as lt,r as ct,g as je,M as dt,P as ut,u as ke,i as pt,a as mt}from"./Post-011d59cf.js";import{B as I}from"./Button-0c7a912b.js";import{a as ie}from"./axios-4a70c6fc.js";import{u as Ae,R as ft}from"./Rating-c9dcf923.js";import{k as ht,Q}from"./react-toastify.esm-96ce24d9.js";/* empty css             *//* empty css                      */import{e as gt,k as de,c as ue,T as xt}from"./Typography-ae9765a8.js";import{a as Ue,o as Ce,d as $e}from"./useIsFocusVisible-e1f2172a.js";import{d as vt}from"./debounce-517eeb3c.js";const bt=["className","component"];function Pt(e={}){const{themeId:r,defaultTheme:o,defaultClassName:i="MuiBox-root",generateClassName:h}=e,x=Ve("div",{shouldForwardProp:v=>v!=="theme"&&v!=="sx"&&v!=="as"})(Ye);return a.forwardRef(function(s,b){const u=Qe(o),p=gt(s),{className:$,component:j="div"}=p,c=H(p,bt);return t.jsx(x,P({as:j,ref:b,className:J($,h?h(i):i),theme:r&&u[r]||u},c))})}const yt=Ze(),jt=Pt({themeId:Je,defaultTheme:yt,defaultClassName:"MuiBox-root",generateClassName:et.generate}),ne=jt,kt=["addEndListener","appear","children","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"];function le(e){return`scale(${e}, ${e**2})`}const Ct={entering:{opacity:1,transform:le(1)},entered:{opacity:1,transform:"none"}},se=typeof navigator<"u"&&/^((?!chrome|android).)*(safari|mobile)/i.test(navigator.userAgent)&&/(os |version\/)15(.|_)4/i.test(navigator.userAgent),He=a.forwardRef(function(r,o){const{addEndListener:i,appear:h=!0,children:x,easing:f,in:v,onEnter:s,onEntered:b,onEntering:u,onExit:p,onExited:$,onExiting:j,style:c,timeout:n="auto",TransitionComponent:m=lt}=r,g=H(r,kt),w=a.useRef(),_=a.useRef(),k=Ae(),L=a.useRef(null),F=Ue(L,x.ref,o),B=l=>E=>{if(l){const N=L.current;E===void 0?l(N):l(N,E)}},V=B(u),Y=B((l,E)=>{ct(l);const{duration:N,delay:O,easing:T}=je({style:c,timeout:n,easing:f},{mode:"enter"});let z;n==="auto"?(z=k.transitions.getAutoHeightDuration(l.clientHeight),_.current=z):z=N,l.style.transition=[k.transitions.create("opacity",{duration:z,delay:O}),k.transitions.create("transform",{duration:se?z:z*.666,delay:O,easing:T})].join(","),s&&s(l,E)}),ee=B(b),S=B(j),G=B(l=>{const{duration:E,delay:N,easing:O}=je({style:c,timeout:n,easing:f},{mode:"exit"});let T;n==="auto"?(T=k.transitions.getAutoHeightDuration(l.clientHeight),_.current=T):T=E,l.style.transition=[k.transitions.create("opacity",{duration:T,delay:N}),k.transitions.create("transform",{duration:se?T:T*.666,delay:se?N:N||T*.333,easing:O})].join(","),l.style.opacity=0,l.style.transform=le(.75),p&&p(l)}),te=B($),K=l=>{n==="auto"&&(w.current=setTimeout(l,_.current||0)),i&&i(L.current,l)};return a.useEffect(()=>()=>{clearTimeout(w.current)},[]),t.jsx(m,P({appear:h,in:v,nodeRef:L,onEnter:Y,onEntered:ee,onEntering:V,onExit:G,onExited:te,onExiting:S,addEndListener:K,timeout:n==="auto"?null:n},g,{children:(l,E)=>a.cloneElement(x,P({style:P({opacity:0,transform:le(.75),visibility:l==="exited"&&!v?"hidden":void 0},Ct[l],c,x.props.style),ref:F},E))}))});He.muiSupportAuto=!0;const $t=He;function Et(e){return ze("MuiLinearProgress",e)}De("MuiLinearProgress",["root","colorPrimary","colorSecondary","determinate","indeterminate","buffer","query","dashed","dashedColorPrimary","dashedColorSecondary","bar","barColorPrimary","barColorSecondary","bar1Indeterminate","bar1Determinate","bar1Buffer","bar2Indeterminate","bar2Buffer"]);const Nt=["className","color","value","valueBuffer","variant"];let q=e=>e,Ee,Ne,Te,Re,we,_e;const ce=4,Tt=de(Ee||(Ee=q`
  0% {
    left: -35%;
    right: 100%;
  }

  60% {
    left: 100%;
    right: -90%;
  }

  100% {
    left: 100%;
    right: -90%;
  }
`)),Rt=de(Ne||(Ne=q`
  0% {
    left: -200%;
    right: 100%;
  }

  60% {
    left: 107%;
    right: -8%;
  }

  100% {
    left: 107%;
    right: -8%;
  }
`)),wt=de(Te||(Te=q`
  0% {
    opacity: 1;
    background-position: 0 -23px;
  }

  60% {
    opacity: 0;
    background-position: 0 -23px;
  }

  100% {
    opacity: 1;
    background-position: -200px -23px;
  }
`)),_t=e=>{const{classes:r,variant:o,color:i}=e,h={root:["root",`color${D(i)}`,o],dashed:["dashed",`dashedColor${D(i)}`],bar1:["bar",`barColor${D(i)}`,(o==="indeterminate"||o==="query")&&"bar1Indeterminate",o==="determinate"&&"bar1Determinate",o==="buffer"&&"bar1Buffer"],bar2:["bar",o!=="buffer"&&`barColor${D(i)}`,o==="buffer"&&`color${D(i)}`,(o==="indeterminate"||o==="query")&&"bar2Indeterminate",o==="buffer"&&"bar2Buffer"]};return Ie(h,Et,r)},pe=(e,r)=>r==="inherit"?"currentColor":e.vars?e.vars.palette.LinearProgress[`${r}Bg`]:e.palette.mode==="light"?tt(e.palette[r].main,.62):rt(e.palette[r].main,.5),Lt=W("span",{name:"MuiLinearProgress",slot:"Root",overridesResolver:(e,r)=>{const{ownerState:o}=e;return[r.root,r[`color${D(o.color)}`],r[o.variant]]}})(({ownerState:e,theme:r})=>P({position:"relative",overflow:"hidden",display:"block",height:4,zIndex:0,"@media print":{colorAdjust:"exact"},backgroundColor:pe(r,e.color)},e.color==="inherit"&&e.variant!=="buffer"&&{backgroundColor:"none","&::before":{content:'""',position:"absolute",left:0,top:0,right:0,bottom:0,backgroundColor:"currentColor",opacity:.3}},e.variant==="buffer"&&{backgroundColor:"transparent"},e.variant==="query"&&{transform:"rotate(180deg)"})),Bt=W("span",{name:"MuiLinearProgress",slot:"Dashed",overridesResolver:(e,r)=>{const{ownerState:o}=e;return[r.dashed,r[`dashedColor${D(o.color)}`]]}})(({ownerState:e,theme:r})=>{const o=pe(r,e.color);return P({position:"absolute",marginTop:0,height:"100%",width:"100%"},e.color==="inherit"&&{opacity:.3},{backgroundImage:`radial-gradient(${o} 0%, ${o} 16%, transparent 42%)`,backgroundSize:"10px 10px",backgroundPosition:"0 -23px"})},ue(Re||(Re=q`
    animation: ${0} 3s infinite linear;
  `),wt)),St=W("span",{name:"MuiLinearProgress",slot:"Bar1",overridesResolver:(e,r)=>{const{ownerState:o}=e;return[r.bar,r[`barColor${D(o.color)}`],(o.variant==="indeterminate"||o.variant==="query")&&r.bar1Indeterminate,o.variant==="determinate"&&r.bar1Determinate,o.variant==="buffer"&&r.bar1Buffer]}})(({ownerState:e,theme:r})=>P({width:"100%",position:"absolute",left:0,bottom:0,top:0,transition:"transform 0.2s linear",transformOrigin:"left",backgroundColor:e.color==="inherit"?"currentColor":(r.vars||r).palette[e.color].main},e.variant==="determinate"&&{transition:`transform .${ce}s linear`},e.variant==="buffer"&&{zIndex:1,transition:`transform .${ce}s linear`}),({ownerState:e})=>(e.variant==="indeterminate"||e.variant==="query")&&ue(we||(we=q`
      width: auto;
      animation: ${0} 2.1s cubic-bezier(0.65, 0.815, 0.735, 0.395) infinite;
    `),Tt)),zt=W("span",{name:"MuiLinearProgress",slot:"Bar2",overridesResolver:(e,r)=>{const{ownerState:o}=e;return[r.bar,r[`barColor${D(o.color)}`],(o.variant==="indeterminate"||o.variant==="query")&&r.bar2Indeterminate,o.variant==="buffer"&&r.bar2Buffer]}})(({ownerState:e,theme:r})=>P({width:"100%",position:"absolute",left:0,bottom:0,top:0,transition:"transform 0.2s linear",transformOrigin:"left"},e.variant!=="buffer"&&{backgroundColor:e.color==="inherit"?"currentColor":(r.vars||r).palette[e.color].main},e.color==="inherit"&&{opacity:.3},e.variant==="buffer"&&{backgroundColor:pe(r,e.color),transition:`transform .${ce}s linear`}),({ownerState:e})=>(e.variant==="indeterminate"||e.variant==="query")&&ue(_e||(_e=q`
      width: auto;
      animation: ${0} 2.1s cubic-bezier(0.165, 0.84, 0.44, 1) 1.15s infinite;
    `),Rt)),Dt=a.forwardRef(function(r,o){const i=Oe({props:r,name:"MuiLinearProgress"}),{className:h,color:x="primary",value:f,valueBuffer:v,variant:s="indeterminate"}=i,b=H(i,Nt),u=P({},i,{color:x,variant:s}),p=_t(u),$=Ae(),j={},c={bar1:{},bar2:{}};if((s==="determinate"||s==="buffer")&&f!==void 0){j["aria-valuenow"]=Math.round(f),j["aria-valuemin"]=0,j["aria-valuemax"]=100;let n=f-100;$.direction==="rtl"&&(n=-n),c.bar1.transform=`translateX(${n}%)`}if(s==="buffer"&&v!==void 0){let n=(v||0)-100;$.direction==="rtl"&&(n=-n),c.bar2.transform=`translateX(${n}%)`}return t.jsxs(Lt,P({className:J(p.root,h),ownerState:u,role:"progressbar"},j,{ref:o},b,{children:[s==="buffer"?t.jsx(Bt,{className:p.dashed,ownerState:u}):null,t.jsx(St,{className:p.bar1,ownerState:u,style:c.bar1}),s==="determinate"?null:t.jsx(zt,{className:p.bar2,ownerState:u,style:c.bar2})]}))}),Ot=Dt;function It(e){return ze("MuiPopover",e)}De("MuiPopover",["root","paper"]);const Mt=["onEntering"],At=["action","anchorEl","anchorOrigin","anchorPosition","anchorReference","children","className","container","elevation","marginThreshold","open","PaperProps","slots","slotProps","transformOrigin","TransitionComponent","transitionDuration","TransitionProps"],Ut=["slotProps"];function Le(e,r){let o=0;return typeof r=="number"?o=r:r==="center"?o=e.height/2:r==="bottom"&&(o=e.height),o}function Be(e,r){let o=0;return typeof r=="number"?o=r:r==="center"?o=e.width/2:r==="right"&&(o=e.width),o}function Se(e){return[e.horizontal,e.vertical].map(r=>typeof r=="number"?`${r}px`:r).join(" ")}function ae(e){return typeof e=="function"?e():e}const Ht=e=>{const{classes:r}=e;return Ie({root:["root"],paper:["paper"]},It,r)},Wt=W(dt,{name:"MuiPopover",slot:"Root",overridesResolver:(e,r)=>r.root})({}),qt=W(ut,{name:"MuiPopover",slot:"Paper",overridesResolver:(e,r)=>r.paper})({position:"absolute",overflowY:"auto",overflowX:"hidden",minWidth:16,minHeight:16,maxWidth:"calc(100% - 32px)",maxHeight:"calc(100% - 32px)",outline:0}),Ft=a.forwardRef(function(r,o){var i,h,x;const f=Oe({props:r,name:"MuiPopover"}),{action:v,anchorEl:s,anchorOrigin:b={vertical:"top",horizontal:"left"},anchorPosition:u,anchorReference:p="anchorEl",children:$,className:j,container:c,elevation:n=8,marginThreshold:m=16,open:g,PaperProps:w={},slots:_,slotProps:k,transformOrigin:L={vertical:"top",horizontal:"left"},TransitionComponent:F=$t,transitionDuration:B="auto",TransitionProps:{onEntering:V}={}}=f,Y=H(f.TransitionProps,Mt),ee=H(f,At),S=(i=k==null?void 0:k.paper)!=null?i:w,G=a.useRef(),te=Ue(G,S.ref),K=P({},f,{anchorOrigin:b,anchorReference:p,elevation:n,marginThreshold:m,externalPaperSlotProps:S,transformOrigin:L,TransitionComponent:F,transitionDuration:B,TransitionProps:Y}),l=Ht(K),E=a.useCallback(()=>{if(p==="anchorPosition")return u;const d=ae(s),C=(d&&d.nodeType===1?d:Ce(G.current).body).getBoundingClientRect();return{top:C.top+Le(C,b.vertical),left:C.left+Be(C,b.horizontal)}},[s,b.horizontal,b.vertical,u,p]),N=a.useCallback(d=>({vertical:Le(d,L.vertical),horizontal:Be(d,L.horizontal)}),[L.horizontal,L.vertical]),O=a.useCallback(d=>{const y={width:d.offsetWidth,height:d.offsetHeight},C=N(y);if(p==="none")return{top:null,left:null,transformOrigin:Se(C)};const ge=E();let A=ge.top-C.vertical,U=ge.left-C.horizontal;const xe=A+y.height,ve=U+y.width,be=$e(ae(s)),Pe=be.innerHeight-m,ye=be.innerWidth-m;if(A<m){const R=A-m;A-=R,C.vertical+=R}else if(xe>Pe){const R=xe-Pe;A-=R,C.vertical+=R}if(U<m){const R=U-m;U-=R,C.horizontal+=R}else if(ve>ye){const R=ve-ye;U-=R,C.horizontal+=R}return{top:`${Math.round(A)}px`,left:`${Math.round(U)}px`,transformOrigin:Se(C)}},[s,p,E,N,m]),[T,z]=a.useState(g),M=a.useCallback(()=>{const d=G.current;if(!d)return;const y=O(d);y.top!==null&&(d.style.top=y.top),y.left!==null&&(d.style.left=y.left),d.style.transformOrigin=y.transformOrigin,z(!0)},[O]),We=(d,y)=>{V&&V(d,y),M()},qe=()=>{z(!1)};a.useEffect(()=>{g&&M()}),a.useImperativeHandle(v,()=>g?{updatePosition:()=>{M()}}:null,[g,M]),a.useEffect(()=>{if(!g)return;const d=vt(()=>{M()}),y=$e(s);return y.addEventListener("resize",d),()=>{d.clear(),y.removeEventListener("resize",d)}},[s,g,M]);let me=B;B==="auto"&&!F.muiSupportAuto&&(me=void 0);const Fe=c||(s?Ce(ae(s)).body:void 0),re=(h=_==null?void 0:_.root)!=null?h:Wt,fe=(x=_==null?void 0:_.paper)!=null?x:qt,Ge=ke({elementType:fe,externalSlotProps:P({},S,{style:T?S.style:P({},S.style,{opacity:0})}),additionalProps:{elevation:n,ref:te},ownerState:K,className:J(l.paper,S==null?void 0:S.className)}),he=ke({elementType:re,externalSlotProps:(k==null?void 0:k.root)||{},externalForwardedProps:ee,additionalProps:{ref:o,slotProps:{backdrop:{invisible:!0}},container:Fe,open:g},ownerState:K,className:J(l.root,j)}),{slotProps:Ke}=he,Xe=H(he,Ut);return t.jsx(re,P({},Xe,!pt(re)&&{slotProps:Ke},{children:t.jsx(F,P({appear:!0,in:g,onEntering:We,onExited:qe,timeout:me},Y,{children:t.jsx(fe,P({},Ge,{children:$}))}))}))}),Gt=Ft,Kt=({post:e})=>{const[r,o]=a.useState(!1),[i,h]=a.useState(!0),x=Me("token"),[f,v]=a.useState(e.comments),s=ot(),b=a.useRef(null),u=nt(),p=async(n,m)=>{const w=await(await fetch(`http://127.0.0.1:3000/api/v1/posts/${n}/like`,{method:"POST",headers:{Authorization:`Bearer ${x}`}})).json();h(!1),o(w.post.likes.includes(m))},$=async(n,m)=>{const w=await(await fetch(`http://127.0.0.1:3000/api/v1/posts/${n}/unlike`,{method:"POST",headers:{Authorization:`Bearer ${x}`}})).json();h(!1),o(w.post.likes.includes(m))},j=(n,m)=>async g=>{g.preventDefault();const w={user:m,text:b.current.value},_=await ie.post(`http://127.0.0.1:3000/api/v1/posts/${n}/add-comment`,w,{headers:{Authorization:`Bearer ${x}`}}),{data:k}=_;console.log(k.post.comments),v(k.post.comments),b.current.value=""};a.useEffect(()=>{u(st())},[u]);const{user:c}=at(n=>n.user,it);return a.useEffect(()=>{o(e.likes.includes(s))},[e.likes,s]),t.jsx(t.Fragment,{children:t.jsxs("div",{className:"post",children:[t.jsx("div",{className:"post-avatar",children:t.jsx(X,{to:`/profile/${e.user._id}`,children:t.jsx(oe,{alt:e.user.name,src:`http://127.0.0.1:3000${e.user.photo}`})})}),t.jsxs("div",{className:"post-header",children:[t.jsx("div",{className:"post-by mb-2",children:t.jsx("p",{style:{margin:0},children:e.text})}),t.jsxs("div",{className:"post-details",children:[t.jsx("div",{className:"post-img",children:t.jsx("img",{src:e.book.book_image,alt:e.book.title})}),t.jsxs("div",{className:"post-content",children:[t.jsx("h4",{children:t.jsx(X,{to:`/book/${e.book._id}`,children:e.book.title})}),t.jsxs("div",{className:"post-author",children:["by ",t.jsx(X,{to:"author",children:e.book.author.name})]}),t.jsxs("div",{className:"post-cta",children:[t.jsx(mt,{})," ",t.jsxs("div",{className:"post-rating",children:["Rate this :"," ",t.jsx(ft,{name:"half-rating-read",defaultValue:0,size:"small"})]})]}),t.jsx("div",{className:"post-description",children:t.jsx("p",{children:e.book.description})})]})]}),t.jsxs("div",{className:"post-activity",children:[r?t.jsx(I,{type:"button",variant:"text",text:`${r?"Unlike":"Like"}`,onClick:()=>$(e._id,s)}):t.jsx(I,{type:"button",variant:"text",text:`${r?"Unlike":"Like"}`,onClick:()=>p(e._id,s)})," ","| ",t.jsx(I,{type:"button",variant:"text",text:"Comment"})]})]}),t.jsxs("div",{className:"post-footer",children:[r&&t.jsx("div",{className:"post-liked",children:"You liked this"}),f&&t.jsx("ul",{className:"post-comments",children:f.map(n=>t.jsx("li",{children:t.jsxs("div",{className:"comment-body",children:[t.jsx(oe,{alt:n.user.name,src:`http://127.0.0.1:3000${n.user.photo}`}),t.jsxs("div",{className:"comment-user",children:[t.jsx("h6",{className:"user-name mb-1",children:t.jsx(X,{to:`/profile/${n.user._id}`,children:n.user.name})}),t.jsx("div",{className:"user-comment",children:n.text})]})]})},n._id))}),t.jsxs("div",{className:"post-comment",children:[t.jsx(oe,{alt:c.name,src:`http://127.0.0.1:3000${c.photo}`}),t.jsx("form",{method:"post",onSubmit:j(e._id,s),children:t.jsxs("div",{className:"form-group d-flex",style:{gap:"2%"},children:[t.jsx("textarea",{name:"comment",id:"comment",style:{height:"40px"},ref:b}),t.jsx(I,{variant:"solid",text:"comment",sx:{padding:"3px 10px"},type:"submit"})]})})]})]})]})})};Kt.propTypes={post:Z.object};const Xt=({book:e,currentUser:r})=>{const[o,i]=a.useState(null),[h,x]=a.useState(e.readingProgress),f=a.useRef(null),v=Me("token"),s=c=>{i(c.currentTarget)},b=()=>{i(null)},u=!!o,p=u?"simple-popover":void 0,$=async c=>{try{const n={readingProgress:Number(f.current.value)},m=await ie.patch(`http://127.0.0.1:3000/api/v1/shelf/update-progress/${c}`,n,{headers:{Authorization:`Bearer ${v}`}}),{data:g}=m;x(f.current.value),Q.success(g.message)}catch(n){Q.error(n.message)}},j=async c=>{try{const n={readingProgress:100},m=await ie.patch(`http://127.0.0.1:3000/api/v1/shelf/update-progress/${c}`,n,{headers:{Authorization:`Bearer ${v}`}}),{data:g}=m;x(100),i(null),Q.success(g.message)}catch(n){Q.error(n.message)}};return t.jsxs("div",{className:"reading mb-3",children:[t.jsx("div",{className:"reading-img",children:t.jsx("img",{src:e.book.book_image,alt:e.book.title})}),t.jsxs("div",{className:"reading-content",children:[t.jsx("h6",{children:t.jsx(X,{to:`/book/${e.book._id}`,style:{color:"#2a2a2a"},children:e.book.title})}),t.jsx("div",{className:"mb-2",children:e.book.author.name}),h>0&&t.jsxs(ne,{sx:{display:"flex",alignItems:"center"},children:[t.jsx(ne,{sx:{width:"100%",mr:1},children:t.jsx(Ot,{variant:"determinate",value:Number(h),color:"success"})}),t.jsx(ne,{sx:{minWidth:35},children:t.jsx(xt,{variant:"body2",color:"text.secondary",children:`${Math.round(h)}/100%`})})]}),r&&t.jsx(I,{text:"update progress",variant:"outline",sx:{fontSize:"12px",padding:"5px 15px",marginTop:"10px"},onClick:s})]}),t.jsx(Gt,{id:p,open:u,anchorEl:o,onClose:b,anchorOrigin:{vertical:"bottom",horizontal:"left"},children:t.jsxs("div",{className:"progress-wrapper",children:[t.jsxs("div",{className:"progress-top",children:[t.jsx("div",{className:"progress-form",children:t.jsxs("div",{children:[t.jsxs("label",{htmlFor:"reading",children:["Currently on",t.jsx("input",{type:"number",name:"reading",id:"reading",style:{height:"25px",width:"60px",margin:"0 10px",padding:"2px 5px"},max:100,min:0,ref:f}),t.jsx("span",{children:"of 100%"})]}),t.jsx(I,{text:"Update",variant:"solid",sx:{padding:"2px 7px",fontSize:"12px",marginLeft:"10px"},onClick:()=>$(e.book._id)})]})}),t.jsx(I,{text:"I'm finished",variant:"text",onClick:()=>j(e.book._id)})]}),t.jsx("div",{className:"progress-footer"})]})}),t.jsx(ht,{position:"bottom-left",limit:1})]})};Xt.propTypes={book:Z.object,setOpen:Z.func,currentUser:Z.bool};export{Xt as C,Kt as P};
