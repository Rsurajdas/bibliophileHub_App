import{ad as Ye,ae as Qe,r as i,af as Ve,w as A,j as t,_ as j,x as J,ag as Ze,ah as Je,X as et,a4 as ze,T as De,z as Me,D as Oe,E as U,G as S,H as Ie,y as Ae,ai as tt,aj as rt,Y as je,Z as ke,P as Z,ak as ot,c as He,g as nt,L as st,a as K,a9 as oe,B as H,b as ie,k as at,Q as V}from"./index-a213bcde.js";import{T as it,r as lt,g as Ce,M as ct,P as dt,u as $e,i as ut}from"./Post-12fc1509.js";/* empty css             */import{e as pt,k as de,c as ue,T as mt}from"./Typography-4a7dcdcf.js";import{d as ft}from"./debounce-517eeb3c.js";const ht=["className","component"];function gt(e={}){const{themeId:r,defaultTheme:o,defaultClassName:a="MuiBox-root",generateClassName:g}=e,P=Ye("div",{shouldForwardProp:b=>b!=="theme"&&b!=="sx"&&b!=="as"})(Qe);return i.forwardRef(function(s,x){const f=Ve(o),p=pt(s),{className:l,component:v="div"}=p,c=A(p,ht);return t.jsx(P,j({as:v,ref:x,className:J(l,g?g(a):a),theme:r&&f[r]||f},c))})}const xt=Ze(),vt=gt({themeId:Je,defaultTheme:xt,defaultClassName:"MuiBox-root",generateClassName:et.generate}),ne=vt,bt=["addEndListener","appear","children","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"];function le(e){return`scale(${e}, ${e**2})`}const Pt={entering:{opacity:1,transform:le(1)},entered:{opacity:1,transform:"none"}},se=typeof navigator<"u"&&/^((?!chrome|android).)*(safari|mobile)/i.test(navigator.userAgent)&&/(os |version\/)15(.|_)4/i.test(navigator.userAgent),Ue=i.forwardRef(function(r,o){const{addEndListener:a,appear:g=!0,children:P,easing:m,in:b,onEnter:s,onEntered:x,onEntering:f,onExit:p,onExited:l,onExiting:v,style:c,timeout:n="auto",TransitionComponent:h=it}=r,y=A(r,bt),X=i.useRef(),z=i.useRef(),$=ze(),R=i.useRef(null),F=De(R,P.ref,o),_=d=>E=>{if(d){const N=R.current;E===void 0?d(N):d(N,E)}},Y=_(f),Q=_((d,E)=>{lt(d);const{duration:N,delay:D,easing:T}=Ce({style:c,timeout:n,easing:m},{mode:"enter"});let B;n==="auto"?(B=$.transitions.getAutoHeightDuration(d.clientHeight),z.current=B):B=N,d.style.transition=[$.transitions.create("opacity",{duration:B,delay:D}),$.transitions.create("transform",{duration:se?B:B*.666,delay:D,easing:T})].join(","),s&&s(d,E)}),ee=_(x),L=_(v),q=_(d=>{const{duration:E,delay:N,easing:D}=Ce({style:c,timeout:n,easing:m},{mode:"exit"});let T;n==="auto"?(T=$.transitions.getAutoHeightDuration(d.clientHeight),z.current=T):T=E,d.style.transition=[$.transitions.create("opacity",{duration:T,delay:N}),$.transitions.create("transform",{duration:se?T:T*.666,delay:se?N:N||T*.333,easing:D})].join(","),d.style.opacity=0,d.style.transform=le(.75),p&&p(d)}),te=_(l),G=d=>{n==="auto"&&(X.current=setTimeout(d,z.current||0)),a&&a(R.current,d)};return i.useEffect(()=>()=>{clearTimeout(X.current)},[]),t.jsx(h,j({appear:g,in:b,nodeRef:R,onEnter:Q,onEntered:ee,onEntering:Y,onExit:q,onExited:te,onExiting:L,addEndListener:G,timeout:n==="auto"?null:n},y,{children:(d,E)=>i.cloneElement(P,j({style:j({opacity:0,transform:le(.75),visibility:d==="exited"&&!b?"hidden":void 0},Pt[d],c,P.props.style),ref:F},E))}))});Ue.muiSupportAuto=!0;const yt=Ue;function jt(e){return Me("MuiLinearProgress",e)}Oe("MuiLinearProgress",["root","colorPrimary","colorSecondary","determinate","indeterminate","buffer","query","dashed","dashedColorPrimary","dashedColorSecondary","bar","barColorPrimary","barColorSecondary","bar1Indeterminate","bar1Determinate","bar1Buffer","bar2Indeterminate","bar2Buffer"]);const kt=["className","color","value","valueBuffer","variant"];let W=e=>e,Ee,Ne,Te,we,Re,_e;const ce=4,Ct=de(Ee||(Ee=W`
  0% {
    left: -35%;
    right: 100%;
  }

  60% {
    left: 100%;
    right: -90%;
  }

  100% {
    left: 100%;
    right: -90%;
  }
`)),$t=de(Ne||(Ne=W`
  0% {
    left: -200%;
    right: 100%;
  }

  60% {
    left: 107%;
    right: -8%;
  }

  100% {
    left: 107%;
    right: -8%;
  }
`)),Et=de(Te||(Te=W`
  0% {
    opacity: 1;
    background-position: 0 -23px;
  }

  60% {
    opacity: 0;
    background-position: 0 -23px;
  }

  100% {
    opacity: 1;
    background-position: -200px -23px;
  }
`)),Nt=e=>{const{classes:r,variant:o,color:a}=e,g={root:["root",`color${S(a)}`,o],dashed:["dashed",`dashedColor${S(a)}`],bar1:["bar",`barColor${S(a)}`,(o==="indeterminate"||o==="query")&&"bar1Indeterminate",o==="determinate"&&"bar1Determinate",o==="buffer"&&"bar1Buffer"],bar2:["bar",o!=="buffer"&&`barColor${S(a)}`,o==="buffer"&&`color${S(a)}`,(o==="indeterminate"||o==="query")&&"bar2Indeterminate",o==="buffer"&&"bar2Buffer"]};return Ae(g,jt,r)},pe=(e,r)=>r==="inherit"?"currentColor":e.vars?e.vars.palette.LinearProgress[`${r}Bg`]:e.palette.mode==="light"?tt(e.palette[r].main,.62):rt(e.palette[r].main,.5),Tt=U("span",{name:"MuiLinearProgress",slot:"Root",overridesResolver:(e,r)=>{const{ownerState:o}=e;return[r.root,r[`color${S(o.color)}`],r[o.variant]]}})(({ownerState:e,theme:r})=>j({position:"relative",overflow:"hidden",display:"block",height:4,zIndex:0,"@media print":{colorAdjust:"exact"},backgroundColor:pe(r,e.color)},e.color==="inherit"&&e.variant!=="buffer"&&{backgroundColor:"none","&::before":{content:'""',position:"absolute",left:0,top:0,right:0,bottom:0,backgroundColor:"currentColor",opacity:.3}},e.variant==="buffer"&&{backgroundColor:"transparent"},e.variant==="query"&&{transform:"rotate(180deg)"})),wt=U("span",{name:"MuiLinearProgress",slot:"Dashed",overridesResolver:(e,r)=>{const{ownerState:o}=e;return[r.dashed,r[`dashedColor${S(o.color)}`]]}})(({ownerState:e,theme:r})=>{const o=pe(r,e.color);return j({position:"absolute",marginTop:0,height:"100%",width:"100%"},e.color==="inherit"&&{opacity:.3},{backgroundImage:`radial-gradient(${o} 0%, ${o} 16%, transparent 42%)`,backgroundSize:"10px 10px",backgroundPosition:"0 -23px"})},ue(we||(we=W`
    animation: ${0} 3s infinite linear;
  `),Et)),Rt=U("span",{name:"MuiLinearProgress",slot:"Bar1",overridesResolver:(e,r)=>{const{ownerState:o}=e;return[r.bar,r[`barColor${S(o.color)}`],(o.variant==="indeterminate"||o.variant==="query")&&r.bar1Indeterminate,o.variant==="determinate"&&r.bar1Determinate,o.variant==="buffer"&&r.bar1Buffer]}})(({ownerState:e,theme:r})=>j({width:"100%",position:"absolute",left:0,bottom:0,top:0,transition:"transform 0.2s linear",transformOrigin:"left",backgroundColor:e.color==="inherit"?"currentColor":(r.vars||r).palette[e.color].main},e.variant==="determinate"&&{transition:`transform .${ce}s linear`},e.variant==="buffer"&&{zIndex:1,transition:`transform .${ce}s linear`}),({ownerState:e})=>(e.variant==="indeterminate"||e.variant==="query")&&ue(Re||(Re=W`
      width: auto;
      animation: ${0} 2.1s cubic-bezier(0.65, 0.815, 0.735, 0.395) infinite;
    `),Ct)),_t=U("span",{name:"MuiLinearProgress",slot:"Bar2",overridesResolver:(e,r)=>{const{ownerState:o}=e;return[r.bar,r[`barColor${S(o.color)}`],(o.variant==="indeterminate"||o.variant==="query")&&r.bar2Indeterminate,o.variant==="buffer"&&r.bar2Buffer]}})(({ownerState:e,theme:r})=>j({width:"100%",position:"absolute",left:0,bottom:0,top:0,transition:"transform 0.2s linear",transformOrigin:"left"},e.variant!=="buffer"&&{backgroundColor:e.color==="inherit"?"currentColor":(r.vars||r).palette[e.color].main},e.color==="inherit"&&{opacity:.3},e.variant==="buffer"&&{backgroundColor:pe(r,e.color),transition:`transform .${ce}s linear`}),({ownerState:e})=>(e.variant==="indeterminate"||e.variant==="query")&&ue(_e||(_e=W`
      width: auto;
      animation: ${0} 2.1s cubic-bezier(0.165, 0.84, 0.44, 1) 1.15s infinite;
    `),$t)),Lt=i.forwardRef(function(r,o){const a=Ie({props:r,name:"MuiLinearProgress"}),{className:g,color:P="primary",value:m,valueBuffer:b,variant:s="indeterminate"}=a,x=A(a,kt),f=j({},a,{color:P,variant:s}),p=Nt(f),l=ze(),v={},c={bar1:{},bar2:{}};if((s==="determinate"||s==="buffer")&&m!==void 0){v["aria-valuenow"]=Math.round(m),v["aria-valuemin"]=0,v["aria-valuemax"]=100;let n=m-100;l.direction==="rtl"&&(n=-n),c.bar1.transform=`translateX(${n}%)`}if(s==="buffer"&&b!==void 0){let n=(b||0)-100;l.direction==="rtl"&&(n=-n),c.bar2.transform=`translateX(${n}%)`}return t.jsxs(Tt,j({className:J(p.root,g),ownerState:f,role:"progressbar"},v,{ref:o},x,{children:[s==="buffer"?t.jsx(wt,{className:p.dashed,ownerState:f}):null,t.jsx(Rt,{className:p.bar1,ownerState:f,style:c.bar1}),s==="determinate"?null:t.jsx(_t,{className:p.bar2,ownerState:f,style:c.bar2})]}))}),Bt=Lt;function St(e){return Me("MuiPopover",e)}Oe("MuiPopover",["root","paper"]);const zt=["onEntering"],Dt=["action","anchorEl","anchorOrigin","anchorPosition","anchorReference","children","className","container","elevation","marginThreshold","open","PaperProps","slots","slotProps","transformOrigin","TransitionComponent","transitionDuration","TransitionProps"],Mt=["slotProps"];function Le(e,r){let o=0;return typeof r=="number"?o=r:r==="center"?o=e.height/2:r==="bottom"&&(o=e.height),o}function Be(e,r){let o=0;return typeof r=="number"?o=r:r==="center"?o=e.width/2:r==="right"&&(o=e.width),o}function Se(e){return[e.horizontal,e.vertical].map(r=>typeof r=="number"?`${r}px`:r).join(" ")}function ae(e){return typeof e=="function"?e():e}const Ot=e=>{const{classes:r}=e;return Ae({root:["root"],paper:["paper"]},St,r)},It=U(ct,{name:"MuiPopover",slot:"Root",overridesResolver:(e,r)=>r.root})({}),At=U(dt,{name:"MuiPopover",slot:"Paper",overridesResolver:(e,r)=>r.paper})({position:"absolute",overflowY:"auto",overflowX:"hidden",minWidth:16,minHeight:16,maxWidth:"calc(100% - 32px)",maxHeight:"calc(100% - 32px)",outline:0}),Ht=i.forwardRef(function(r,o){var a,g,P;const m=Ie({props:r,name:"MuiPopover"}),{action:b,anchorEl:s,anchorOrigin:x={vertical:"top",horizontal:"left"},anchorPosition:f,anchorReference:p="anchorEl",children:l,className:v,container:c,elevation:n=8,marginThreshold:h=16,open:y,PaperProps:X={},slots:z,slotProps:$,transformOrigin:R={vertical:"top",horizontal:"left"},TransitionComponent:F=yt,transitionDuration:_="auto",TransitionProps:{onEntering:Y}={}}=m,Q=A(m.TransitionProps,zt),ee=A(m,Dt),L=(a=$==null?void 0:$.paper)!=null?a:X,q=i.useRef(),te=De(q,L.ref),G=j({},m,{anchorOrigin:x,anchorReference:p,elevation:n,marginThreshold:h,externalPaperSlotProps:L,transformOrigin:R,TransitionComponent:F,transitionDuration:_,TransitionProps:Q}),d=Ot(G),E=i.useCallback(()=>{if(p==="anchorPosition")return f;const u=ae(s),C=(u&&u.nodeType===1?u:je(q.current).body).getBoundingClientRect();return{top:C.top+Le(C,x.vertical),left:C.left+Be(C,x.horizontal)}},[s,x.horizontal,x.vertical,f,p]),N=i.useCallback(u=>({vertical:Le(u,R.vertical),horizontal:Be(u,R.horizontal)}),[R.horizontal,R.vertical]),D=i.useCallback(u=>{const k={width:u.offsetWidth,height:u.offsetHeight},C=N(k);if(p==="none")return{top:null,left:null,transformOrigin:Se(C)};const ge=E();let O=ge.top-C.vertical,I=ge.left-C.horizontal;const xe=O+k.height,ve=I+k.width,be=ke(ae(s)),Pe=be.innerHeight-h,ye=be.innerWidth-h;if(O<h){const w=O-h;O-=w,C.vertical+=w}else if(xe>Pe){const w=xe-Pe;O-=w,C.vertical+=w}if(I<h){const w=I-h;I-=w,C.horizontal+=w}else if(ve>ye){const w=ve-ye;I-=w,C.horizontal+=w}return{top:`${Math.round(O)}px`,left:`${Math.round(I)}px`,transformOrigin:Se(C)}},[s,p,E,N,h]),[T,B]=i.useState(y),M=i.useCallback(()=>{const u=q.current;if(!u)return;const k=D(u);k.top!==null&&(u.style.top=k.top),k.left!==null&&(u.style.left=k.left),u.style.transformOrigin=k.transformOrigin,B(!0)},[D]),We=(u,k)=>{Y&&Y(u,k),M()},Fe=()=>{B(!1)};i.useEffect(()=>{y&&M()}),i.useImperativeHandle(b,()=>y?{updatePosition:()=>{M()}}:null,[y,M]),i.useEffect(()=>{if(!y)return;const u=ft(()=>{M()}),k=ke(s);return k.addEventListener("resize",u),()=>{u.clear(),k.removeEventListener("resize",u)}},[s,y,M]);let me=_;_==="auto"&&!F.muiSupportAuto&&(me=void 0);const qe=c||(s?je(ae(s)).body:void 0),re=(g=z==null?void 0:z.root)!=null?g:It,fe=(P=z==null?void 0:z.paper)!=null?P:At,Ge=$e({elementType:fe,externalSlotProps:j({},L,{style:T?L.style:j({},L.style,{opacity:0})}),additionalProps:{elevation:n,ref:te},ownerState:G,className:J(d.paper,L==null?void 0:L.className)}),he=$e({elementType:re,externalSlotProps:($==null?void 0:$.root)||{},externalForwardedProps:ee,additionalProps:{ref:o,slotProps:{backdrop:{invisible:!0}},container:qe,open:y},ownerState:G,className:J(d.root,v)}),{slotProps:Ke}=he,Xe=A(he,Mt);return t.jsx(re,j({},Xe,!ut(re)&&{slotProps:Ke},{children:t.jsx(F,j({appear:!0,in:y,onEntering:We,onExited:Fe,timeout:me},Q,{children:t.jsx(fe,j({},Ge,{children:l}))}))}))}),Ut=Ht,Wt=({post:e})=>{const{user:r,isLoading:o}=ot(),[a,g]=i.useState(!1),P=He("token"),[m,b]=i.useState(e.comments),s=nt(),x=i.useRef(null),f=async(l,v)=>{try{const h=await(await fetch(`https://boiling-wildwood-46640-30ec30629e36.herokuapp.com/api/v1/posts/${l}/${a?"unlike":"like"}`,{method:"POST",headers:{Authorization:`Bearer ${P}`}})).json();console.log(h),g(h.post.likes.includes(v))}catch(c){console.error(c.message)}},p=(l,v)=>async c=>{c.preventDefault();const n={user:v,text:x.current.value},h=await ie.post(`https://boiling-wildwood-46640-30ec30629e36.herokuapp.com/api/v1/posts/${l}/add-comment`,n,{headers:{Authorization:`Bearer ${P}`}}),{data:y}=h;b(y.post.comments),x.current.value=""};return i.useEffect(()=>{const l=e.likes.some(v=>v._id===s);g(l)},[e.likes,s]),o?t.jsx(st,{}):t.jsx(t.Fragment,{children:t.jsxs("div",{className:"post",children:[t.jsx("div",{className:"post-avatar",children:t.jsx(K,{to:`/profile/${e.user._id}`,children:t.jsx(oe,{alt:e.user.name,src:e.user.photo})})}),t.jsxs("div",{className:"post-header",children:[t.jsx("div",{className:"post-by mb-2",children:t.jsx("p",{style:{margin:0},children:e.text})}),t.jsxs("div",{className:"post-details",children:[t.jsx("div",{className:"post-img",children:t.jsx("img",{src:e.book.book_image,alt:e.book.title})}),t.jsxs("div",{className:"post-content",children:[t.jsx("h4",{children:t.jsx(K,{to:`/book/${e.book._id}`,children:e.book.title})}),t.jsxs("div",{className:"post-author",children:["by ",t.jsx(K,{to:"author",children:e.book.author.name})]}),t.jsx("div",{className:"post-description",children:t.jsx("p",{children:e.book.description})})]})]}),t.jsxs("div",{className:"post-activity",children:[t.jsx(H,{type:"button",variant:"text",text:`${a?"Unlike":"Like"}`,onClick:()=>f(e._id,s)})," ","|"," ",t.jsx(H,{type:"button",variant:"text",text:"Comment",onClick:()=>x.current.focus()})]})]}),t.jsxs("div",{className:"post-footer",children:[a&&t.jsx("div",{className:"post-liked",children:"You liked this"}),m&&t.jsx("ul",{className:"post-comments",children:m.map(l=>t.jsx("li",{children:t.jsxs("div",{className:"comment-body",children:[t.jsx(oe,{alt:l.user.name,src:`${l.user.photo}`}),t.jsxs("div",{className:"comment-user",children:[t.jsx("h6",{className:"user-name mb-1",children:t.jsx(K,{to:`/profile/${l.user._id}`,children:l.user.name})}),t.jsx("div",{className:"user-comment",children:l.text})]})]})},l._id))}),t.jsxs("div",{className:"post-comment",children:[t.jsx(oe,{alt:r.name,src:r.photo}),t.jsx("form",{method:"post",onSubmit:p(e._id,s),children:t.jsxs("div",{className:"form-group d-flex",style:{gap:"2%"},children:[t.jsx("textarea",{name:"comment",id:"comment",style:{height:"40px"},ref:x}),t.jsx(H,{variant:"solid",text:"comment",sx:{padding:"3px 10px"},type:"submit"})]})})]})]})]})})};Wt.propTypes={post:Z.object};const Ft=({book:e,currentUser:r})=>{const[o,a]=i.useState(null),[g,P]=i.useState(e.readingProgress),m=i.useRef(null),b=He("token"),s=c=>{a(c.currentTarget)},x=()=>{a(null)},f=!!o,p=f?"simple-popover":void 0,l=async c=>{try{const n={readingProgress:Number(m.current.value)},h=await ie.patch(`https://boiling-wildwood-46640-30ec30629e36.herokuapp.com/api/v1/shelf/update-progress/${c}`,n,{headers:{Authorization:`Bearer ${b}`}}),{data:y}=h;P(m.current.value),V.success(y.message)}catch(n){V.error(n.message)}},v=async c=>{try{const n={readingProgress:100},h=await ie.patch(`https://boiling-wildwood-46640-30ec30629e36.herokuapp.com/api/v1/shelf/update-progress/${c}`,n,{headers:{Authorization:`Bearer ${b}`}}),{data:y}=h;P(100),a(null),V.success(y.message)}catch(n){V.error(n.message)}};return t.jsxs("div",{className:"reading mb-3",children:[t.jsx("div",{className:"reading-img",children:t.jsx("img",{src:e.book.book_image,alt:e.book.title})}),t.jsxs("div",{className:"reading-content",children:[t.jsx("h6",{children:t.jsx(K,{to:`/book/${e.book._id}`,style:{color:"#2a2a2a"},children:e.book.title})}),t.jsx("div",{className:"mb-2",children:e.book.author.name}),g>0&&t.jsxs(ne,{sx:{display:"flex",alignItems:"center"},children:[t.jsx(ne,{sx:{width:"100%",mr:1},children:t.jsx(Bt,{variant:"determinate",value:Number(g),color:"success"})}),t.jsx(ne,{sx:{minWidth:35},children:t.jsx(mt,{variant:"body2",color:"text.secondary",children:`${Math.round(g)}/100%`})})]}),r&&t.jsx(H,{text:"update progress",variant:"outline",sx:{fontSize:"12px",padding:"5px 15px",marginTop:"10px"},onClick:s})]}),t.jsx(Ut,{id:p,open:f,anchorEl:o,onClose:x,anchorOrigin:{vertical:"bottom",horizontal:"left"},children:t.jsxs("div",{className:"progress-wrapper",children:[t.jsxs("div",{className:"progress-top",children:[t.jsx("div",{className:"progress-form",children:t.jsxs("div",{children:[t.jsxs("label",{htmlFor:"reading",children:["Currently on",t.jsx("input",{type:"number",name:"reading",id:"reading",style:{height:"25px",width:"60px",margin:"0 10px",padding:"2px 5px"},max:100,min:0,ref:m}),t.jsx("span",{children:"of 100%"})]}),t.jsx(H,{text:"Update",variant:"solid",sx:{padding:"2px 7px",fontSize:"12px",marginLeft:"10px"},onClick:()=>l(e.book._id)})]})}),t.jsx(H,{text:"I'm finished",variant:"text",onClick:()=>v(e.book._id)})]}),t.jsx("div",{className:"progress-footer"})]})}),t.jsx(at,{position:"bottom-left",limit:1})]})};Ft.propTypes={book:Z.object,setOpen:Z.func,currentUser:Z.bool};export{Ft as C,Wt as P};
